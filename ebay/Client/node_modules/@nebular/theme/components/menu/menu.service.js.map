{"version":3,"file":"menu.service.js","sourceRoot":"","sources":["../../../../../.ng_build/theme/components/menu/menu.service.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Akveo. All Rights Reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n */\n\nimport { Injectable } from '@angular/core';\nimport { Location } from '@angular/common';\nimport { Observable } from 'rxjs/Observable';\nimport { BehaviorSubject } from 'rxjs/BehaviorSubject';\nimport { ReplaySubject } from 'rxjs/ReplaySubject';\nimport { share } from 'rxjs/operators/share';\n\nexport interface NbMenuBag { tag: string; item: NbMenuItem }\n\nconst itemClick$ = new ReplaySubject<NbMenuBag>(1);\nconst addItems$ = new ReplaySubject<{ tag: string; items: NbMenuItem[] }>(1);\nconst navigateHome$ = new ReplaySubject<{ tag: string }>(1);\nconst getSelectedItem$\n  = new ReplaySubject<{ tag: string; listener: BehaviorSubject<NbMenuBag> }>(1);\nconst itemSelect$ = new ReplaySubject<NbMenuBag>(1);\nconst itemHover$ = new ReplaySubject<NbMenuBag>(1);\nconst submenuToggle$ = new ReplaySubject<NbMenuBag>(1);\n\n/**\n * Menu Item options\n * TODO: check if we need both URL and LINK\n */\nexport abstract class NbMenuItem {\n  /**\n   * Item Title\n   * @type {string}\n   */\n  title: string;\n  /**\n   * Item relative link (for routerLink)\n   * @type {string}\n   */\n  link?: string;\n  /**\n   * Item URL (absolute)\n   * @type {string}\n   */\n  url?: string;\n  /**\n   * Icon class name\n   * @type {string}\n   */\n  icon?: string;\n  /**\n   * Expanded by defaul\n   * @type {boolean}\n   */\n  expanded?: boolean;\n  /**\n   * Children items\n   * @type {List<NbMenuItem>}\n   */\n  children?: NbMenuItem[];\n  /**\n   * Children items height\n   * @type {number}\n   */\n  subMenuHeight?: number = 0;\n  /**\n   * HTML Link target\n   * @type {string}\n   */\n  target?: string;\n  /**\n   * Hidden Item\n   * @type {boolean}\n   */\n  hidden?: boolean;\n  /**\n   * Item is selected when partly or fully equal to the current url\n   * @type {string}\n   */\n  pathMatch?: string = 'full'; // TODO: is not set if item is initialized by default, should be set anyway\n  /**\n   * Where this is a home item\n   * @type {boolean}\n   */\n  home?: boolean;\n  /**\n   * Whether the item is just a group (non-clickable)\n   * @type {boolean}\n   */\n  group?: boolean;\n  parent?: NbMenuItem;\n  selected?: boolean;\n  data?: any;\n  fragment?: string;\n}\n\n// TODO: map select events to router change events\n// TODO: review the interface\n/**\n * Menu Service. Allows you to listen to menu events, or to interact with a menu.\n */\n@Injectable()\nexport class NbMenuService {\n\n  /**\n   * Add items to the end of the menu items list\n   * @param {List<NbMenuItem>} items\n   * @param {string} tag\n   */\n  addItems(items: NbMenuItem[], tag?: string) {\n    addItems$.next({ tag, items });\n  }\n\n  /**\n   * Navigate to the home menu item\n   * @param {string} tag\n   */\n  navigateHome(tag?: string) {\n    navigateHome$.next({ tag });\n  }\n\n  /**\n   * Returns currently selected item. Won't subscribe to the future events.\n   * @param {string} tag\n   * @returns {Observable<{tag: string; item: NbMenuItem}>}\n   */\n  getSelectedItem(tag?: string): Observable<NbMenuBag> {\n    const listener = new BehaviorSubject<NbMenuBag>(null);\n\n    getSelectedItem$.next({ tag, listener });\n\n    return listener.asObservable();\n  }\n\n  onItemClick(): Observable<NbMenuBag> {\n    return itemClick$.pipe(share());\n  }\n\n  onItemSelect(): Observable<NbMenuBag> {\n    return itemSelect$.pipe(share());\n  }\n\n  onItemHover(): Observable<NbMenuBag> {\n    return itemHover$.pipe(share());\n  }\n\n  onSubmenuToggle(): Observable<NbMenuBag> {\n    return submenuToggle$.pipe(share());\n  }\n}\n\n@Injectable()\nexport class NbMenuInternalService {\n  private items: NbMenuItem[] = [];\n\n  constructor(private location: Location) {\n    this.items = [];\n  }\n\n  getItems(): NbMenuItem[] {\n    return this.items;\n  }\n\n  prepareItems(items: NbMenuItem[]) {\n    items.forEach(i => this.setParent(i));\n  }\n\n  updateSelection(items: NbMenuItem[], tag: string, collapseOther: boolean = false) {\n    if (collapseOther) {\n      this.collapseAll(items, tag);\n    }\n    items.forEach(item => this.selectItemByUrl(item, tag));\n  }\n\n  resetItems(items: NbMenuItem[]) {\n    items.forEach(i => this.resetItem(i));\n  }\n\n  collapseAll(items: NbMenuItem[], tag: string, except?: NbMenuItem) {\n    items.forEach(i => this.collapseItem(i, tag, except));\n  }\n\n  onAddItem(): Observable<{ tag: string; items: NbMenuItem[] }> {\n    return addItems$.pipe(share());\n  }\n\n  onNavigateHome(): Observable<{ tag: string }> {\n    return navigateHome$.pipe(share());\n  }\n\n  onGetSelectedItem(): Observable<{ tag: string; listener: BehaviorSubject<NbMenuBag> }> {\n    return getSelectedItem$.pipe(share());\n  }\n\n  itemHover(item: NbMenuItem, tag?: string) {\n    itemHover$.next({tag, item});\n  }\n\n  submenuToggle(item: NbMenuItem, tag?: string) {\n    submenuToggle$.next({tag, item});\n  }\n\n  itemSelect(item: NbMenuItem, tag?: string) {\n    itemSelect$.next({tag, item});\n  }\n\n  itemClick(item: NbMenuItem, tag?: string) {\n    itemClick$.next({tag, item});\n  }\n\n  private resetItem(item: NbMenuItem) {\n    item.selected = false;\n\n    item.children && item.children.forEach(child => {\n      this.resetItem(child);\n    });\n  }\n\n  private collapseItem(item: NbMenuItem, tag: string, except?: NbMenuItem) {\n    if (except && item === except) {\n      return;\n    }\n\n    const wasExpanded = item.expanded;\n    item.expanded = false;\n    if (wasExpanded) {\n      this.submenuToggle(item);\n    }\n\n    item.children && item.children.forEach(child => this.collapseItem(child, tag));\n  }\n\n  private setParent(item: NbMenuItem) {\n    item.children && item.children.forEach(child => {\n      child.parent = item;\n      this.setParent(child);\n    });\n  }\n\n  selectItem(item: NbMenuItem, tag: string) {\n    item.selected = true;\n    this.itemSelect(item, tag);\n    this.selectParent(item, tag);\n  }\n\n  private selectParent({ parent: item }: NbMenuItem, tag: string) {\n    if (!item) {\n      return;\n    }\n\n    if (!item.expanded) {\n      item.expanded = true;\n      this.submenuToggle(item, tag);\n    }\n\n    item.selected = true;\n    this.selectParent(item, tag);\n  }\n\n  private selectItemByUrl(item: NbMenuItem, tag: string) {\n    const wasSelected = item.selected;\n    const isSelected = this.selectedInUrl(item);\n    if (!wasSelected && isSelected) {\n      this.selectItem(item, tag);\n    }\n    if (item.children) {\n      this.updateSelection(item.children, tag);\n    }\n  }\n\n  private selectedInUrl(item: NbMenuItem): boolean {\n    const exact: boolean = item.pathMatch === 'full';\n    const location: string = this.location.path();\n\n    return (\n      (exact && location === item.link) ||\n      (!exact && location.includes(item.link)) ||\n      (exact && item.fragment && location.substr(location.indexOf('#') + 1).includes(item.fragment))\n    );\n  }\n}\n"]}